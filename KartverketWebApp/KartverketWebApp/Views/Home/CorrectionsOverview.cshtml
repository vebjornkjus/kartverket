@model KartverketWebApp.Models.CombinedViewModel;




<div class="center-container"><h2>Registrerte endringer</h2></div>

<div class="corrections_table">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Map</th>
                <th>Tittel</th>
                <th>Kartdata</th>
                <th>Kategori</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Positions.Count; i++)
            {
                var sted = Model.Positions[i];
                var stednavn = Model.Stednavn.Count > i ? Model.Stednavn[i] : null;

                <tr>
                    <td>
                        <div id="map_corrections_@i" class="map_corrections"></div> <!-- Ensure each map has a unique id -->
                    </td>
                    <td>@sted.Tittel</td>
                    <td>
                        @sted.Nord, @sted.Ost, @sted.Map_type, @(stednavn != null ? stednavn.Fylkesnavn : "N/A"), @(stednavn != null ? stednavn.Kommunenavn : "N/A")
                    </td>
                    <td>@sted.Rapport_type</td>
                    <td>@sted.Description</td>
                </tr>
            }
        </tbody>
    </table>
</div>



@section Scripts {
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <script>
        // Ensure the model is properly serialized
        var positions = @Html.Raw(Json.Serialize(Model.Positions));

        // Check if there are any positions
        if (positions.length > 0) {
            positions.forEach(function (position, index) {
                // Create a unique map for each position

               var map = L.map('map_corrections_' + index).setView([position.nord, position.ost], 13);


                var norgeKart = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/topo/default/webmercator/{z}/{y}/{x}.png', {
                    attribution: '&copy; <a href="https://www.kartverket.no/">Kartverket</a>'
                });

                var turKart = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/toporaster/default/webmercator/{z}/{y}/{x}.png', {
                    attribution: '&copy; <a href="https://www.kartverket.no/">Kartverket</a>'
                });

                var sjoKart = L.tileLayer('https://cache.kartverket.no/v1/wmts/1.0.0/sjokartraster/default/webmercator/{z}/{y}/{x}.png', {
                    attribution: '&copy; <a href="https://www.kartverket.no/">Kartverket</a>'
                });

                        // Add the appropriate map layer
                        if (position.map_type === "Norge kart") {
                            map.addLayer(norgeKart);
                        } else if (position.map_type === "Turkart") {
                            map.addLayer(turKart);
                        } else if (position.map_type === "Sjøkart") {
                            map.addLayer(sjoKart);
                        } else {
                            console.warn('Map not available for:', position.map_type);
                        }

                        // Create marker for the current position
                        if (position.nord && position.ost) {
                            L.marker([position.nord, position.ost]).addTo(map);
                        } else {
                            console.warn('Position is missing nord or ost:', position);
                        }
                    });
                } else {
                    console.warn('No positions available to display on the map.');
                }
    </script>
}
